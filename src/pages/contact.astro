---
import BaseLayout from '../layouts/baseLayout.astro';
import Social from '../components/social.astro';
import { isValidEmail } from "../components/emailVerification"  
const pageTitle = "Contact Us";
const phone = "666-666-6666"
const email = "test@test.com"

const errors = { username: "", email: "", about: "" };
if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const name = data.get("username");
    const email = data.get("email");
    const about = data.get("about");
    if (typeof name !== "string" || name.length < 1) {
      errors.username += "Please Enter Your Name. ";
    }
    if (typeof email !== "string" || !isValidEmail(email)) {
      errors.email += "Email is not valid. ";
    }
    if (typeof about !== "string") {
      errors.about += "Error Prossesing your Request ";
    }
    const hasErrors = Object.values(errors).some(msg => msg)
    if (!hasErrors) {
      return Astro.redirect("/contact");
    }
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}
---
<BaseLayout pageTitle={pageTitle}>
  <p> Our Contact information</p>
    <p>{phone}</p>
    <p>{email}</p>

    <h1>Register</h1>
  <form method="POST">
    <label>
      Username:
      <input type="text" name="username"required />
    </label>
    {errors.username && <p>{errors.username}</p>}
    <label>
      Email:
      <input type="email" name="email" required />
    </label>
    {errors.email && <p>{errors.email}</p>}
    <label>
      About:
      <input type="text" name="about" required/>
    </label>
    {errors.about && <p>{errors.about}</p>}
    <button>Register</button>
  </form>
    <Social platform="facebook" username="example"/>
    <Social platform="instagram" username="example"/>
</BaseLayout>